<%- include('./partials/header.ejs')%>
<body>
    <%- include('./partials/navbar.ejs')%>
    <div class="container">
        <hr>
        <div style="display: flex; align-items: center;">
            <h1> Perguntas </h1>
            <span class="d-inline-block" style="margin-left: 12px;" tabindex="0" data-toggle="tooltip"
                title="Página com todas as perguntas">
                <button class="btn btn-primary" style="pointer-events: none;" type="button" disabled>?</button>
            </span>
        </div>
        <hr>
        <div>
            <span class="d-inline-block" style="margin-left: 12px;" tabindex="0" data-toggle="tooltip"
                title="Ir para a página de perguntas">
                <a href="/perguntar" class="btn btn-primary">Fazer pergunta</a>
            </span>
            <div style="margin-left: 12px; width: 200px; margin-top: 50px;">
                <label for="filtroTema">Filtrar por tema:</label>
                <select class="form-control" id="filtroTema">
                    <option value="">Todos</option>
                    <option value="1" <%= filtroTema === '1' ? 'selected' : '' %> >Linguagem de programação</option>
                    <option value="2" <%= filtroTema === '2' ? 'selected' : '' %>>Bug em código</option>
                    <option value="3" <%= filtroTema === '3' ? 'selected' : '' %>>Padrão de projeto</option>
                    <option value="4" <%= filtroTema === '4' ? 'selected' : '' %>>Boa prática na escrita</option>
                </select>
                
            </div>
        </div>
        <br>
        <% perguntas.forEach(pergunta => { %>
        <% const tema = pergunta.tema; %>
        <br>
        <div class="card" data-tema="<%= tema %>">
            <div class="card-body">
                <h3><%= pergunta.titulo %></h3>
            </div>
            <div class="card-footer">
                <span class="d-inline-block" style="margin-left: 12px;" tabindex="0" data-toggle="tooltip"
                    title="Ir para página de respostas">
                    <a class="btn btn-primary" href="pergunta/<%= pergunta.id %>">Responder</a>
                </span>
            </div>
        </div>
        <% }) %>
        
        <!-- Links de Paginação -->
        <% if (totalPaginas > 1) { %>
            <ul class="pagination">
                <% const inicio = Math.max(paginaAtual - 2, 1); %>
                <% const fim = Math.min(inicio + 4, totalPaginas); %>
                <% for (let i = inicio; i <= fim; i++) { %>
                    <li class="page-item <%= paginaAtual === i ? 'active' : '' %>">
                        <a class="page-link" href="/?pagina=<%= i %><%= filtroTema ? '&tema=' + filtroTema : '' %>"><%= i %></a>
                    </li>
                <% } %>
            </ul>
        <% } %>        
    </div>

    <script>
        document.getElementById('filtroTema').addEventListener('change', function () {
            var temaSelecionado = this.value;
            window.location.href = "/?tema=" + temaSelecionado;
        });
    </script>

</body>
<%- include('./partials/footer.ejs')%>
